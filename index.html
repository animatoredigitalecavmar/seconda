<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Past Perfect Practice Hub</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            color: #4a5568;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stats-dashboard {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            min-width: 150px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9em;
            color: #718096;
            margin-top: 5px;
        }

        .level-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .level-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 3px solid transparent;
        }

        .level-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .level-card.active {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .level-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .level-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .level-description {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .exercise-area {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            display: none;
        }

        .exercise-area.active {
            display: block;
        }

        .exercise-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .exercise-title {
            color: #4a5568;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .progress-container {
            margin-bottom: 30px;
        }

        .progress-bar {
            background: #e2e8f0;
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            background: linear-gradient(45deg, #667eea, #764ba2);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 6px;
        }

        .progress-text {
            text-align: center;
            font-weight: 600;
            color: #4a5568;
        }

        .exercise-card {
            background: #f7fafc;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .exercise-card.completed {
            border-color: #48bb78;
            background: #f0fff4;
        }

        .exercise-question {
            font-size: 1.2em;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .exercise-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1.1em;
            margin: 10px 0;
            transition: all 0.3s ease;
        }

        .exercise-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .exercise-input.correct {
            border-color: #48bb78;
            background: #f0fff4;
        }

        .exercise-input.incorrect {
            border-color: #f56565;
            background: #fed7d7;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
            font-weight: 600;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .feedback {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 600;
            text-align: center;
        }

        .feedback.correct {
            background: #c6f6d5;
            color: #22543d;
            border: 2px solid #38a169;
        }

        .feedback.incorrect {
            background: #fed7d7;
            color: #742a2a;
            border: 2px solid #e53e3e;
        }

        .reward-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            transition: transform 0.3s ease;
        }

        .reward-popup.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .reward-icon {
            font-size: 4em;
            margin-bottom: 20px;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .shake {
            animation: shake 0.5s ease-in-out;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .achievement-badge {
            display: inline-block;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #744210;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .hint-box {
            background: #e6fffa;
            border: 2px solid #38b2ac;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-style: italic;
            color: #234e52;
        }

        .multiple-choice {
            display: grid;
            gap: 10px;
            margin: 15px 0;
        }

        .choice-btn {
            background: white;
            border: 2px solid #e2e8f0;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .choice-btn:hover {
            border-color: #667eea;
            background: #f7fafc;
        }

        .choice-btn.selected {
            border-color: #667eea;
            background: #ebf8ff;
        }

        .choice-btn.correct {
            border-color: #48bb78;
            background: #f0fff4;
        }

        .choice-btn.incorrect {
            border-color: #f56565;
            background: #fed7d7;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .stats-dashboard {
                flex-direction: column;
                align-items: center;
            }
            
            .level-selector {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Past Perfect Practice Hub</h1>
            <p>Master the Past Perfect Tense with Interactive Exercises</p>
        </div>

        <div class="stats-dashboard">
            <div class="stat-card">
                <div class="stat-number" id="total-points">0</div>
                <div class="stat-label">Total Points</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="correct-answers">0</div>
                <div class="stat-label">Correct Answers</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="current-streak">0</div>
                <div class="stat-label">Current Streak</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="badges-earned">0</div>
                <div class="stat-label">Badges Earned</div>
            </div>
        </div>

        <div class="level-selector">
            <div class="level-card" onclick="selectLevel(1)">
                <div class="level-icon">üå±</div>
                <div class="level-title">Level 1: Basics</div>
                <div class="level-description">Simple past perfect formation with regular verbs</div>
            </div>
            <div class="level-card" onclick="selectLevel(2)">
                <div class="level-icon">‚ö°</div>
                <div class="level-title">Level 2: Irregular Verbs</div>
                <div class="level-description">Past perfect with common irregular verbs</div>
            </div>
            <div class="level-card" onclick="selectLevel(3)">
                <div class="level-icon">üé≠</div>
                <div class="level-title">Level 3: Context</div>
                <div class="level-description">Past perfect in context and time sequences</div>
            </div>
            <div class="level-card" onclick="selectLevel(4)">
                <div class="level-icon">üèÜ</div>
                <div class="level-title">Level 4: Advanced</div>
                <div class="level-description">Complex sentences and mixed tenses</div>
            </div>
        </div>

        <!-- LEVEL 1: BASICS -->
        <div id="level1" class="exercise-area">
            <div class="exercise-header">
                <h2 class="exercise-title">Level 1: Basic Past Perfect</h2>
                <div class="hint-box">
                    üí° <strong>Remember:</strong> Past Perfect = had + past participle (verb + ed for regular verbs)
                </div>
            </div>
            <div class="progress-container">
                <div class="progress-bar"><div class="progress-fill" id="progress1"></div></div>
                <div class="progress-text" id="progress-text1">0/8 completed</div>
            </div>
            <div id="exercises1"></div>
        </div>

        <!-- LEVEL 2: IRREGULAR VERBS -->
        <div id="level2" class="exercise-area">
            <div class="exercise-header">
                <h2 class="exercise-title">Level 2: Irregular Verbs</h2>
                <div class="hint-box">
                    üí° <strong>Remember:</strong> Irregular verbs have special past participle forms (go ‚Üí gone, see ‚Üí seen, etc.)
                </div>
            </div>
            <div class="progress-container">
                <div class="progress-bar"><div class="progress-fill" id="progress2"></div></div>
                <div class="progress-text" id="progress-text2">0/8 completed</div>
            </div>
            <div id="exercises2"></div>
        </div>

        <!-- LEVEL 3: CONTEXT -->
        <div id="level3" class="exercise-area">
            <div class="exercise-header">
                <h2 class="exercise-title">Level 3: Past Perfect in Context</h2>
                <div class="hint-box">
                    üí° <strong>Remember:</strong> Past Perfect shows which action happened first in the past
                </div>
            </div>
            <div class="progress-container">
                <div class="progress-bar"><div class="progress-fill" id="progress3"></div></div>
                <div class="progress-text" id="progress-text3">0/8 completed</div>
            </div>
            <div id="exercises3"></div>
        </div>

        <!-- LEVEL 4: ADVANCED -->
        <div id="level4" class="exercise-area">
            <div class="exercise-header">
                <h2 class="exercise-title">Level 4: Advanced Past Perfect</h2>
                <div class="hint-box">
                    üí° <strong>Remember:</strong> Complex sentences may combine past perfect with other tenses
                </div>
            </div>
            <div class="progress-container">
                <div class="progress-bar"><div class="progress-fill" id="progress4"></div></div>
                <div class="progress-text" id="progress-text4">0/8 completed</div>
            </div>
            <div id="exercises4"></div>
        </div>
    </div>

    <div class="overlay" id="overlay"></div>
    <div class="reward-popup" id="reward-popup">
        <div class="reward-icon" id="reward-icon">üéâ</div>
        <h3 id="reward-title">Great Job!</h3>
        <p id="reward-message">You earned 10 points!</p>
        <div id="reward-badges"></div>
        <button class="btn" onclick="closeReward()">Continue</button>
    </div>

    <script>
        let currentLevel = 0;
        let totalPoints = 0;
        let correctAnswers = 0;
        let currentStreak = 0;
        let badgesEarned = 0;
        let levelProgress = [0, 0, 0, 0];
        let levelCompleted = [false, false, false, false];

        const exercises = {
            1: [
                {
                    type: 'fill',
                    question: 'Complete: By the time I arrived, they _______ (finish) dinner.',
                    answer: 'had finished',
                    hint: 'Use "had" + past participle of "finish"'
                },
                {
                    type: 'fill',
                    question: 'Complete: She _______ (study) English before she moved to London.',
                    answer: 'had studied',
                    hint: 'Use "had" + past participle of "study"'
                },
                {
                    type: 'multiple',
                    question: 'Which sentence is correct?',
                    choices: [
                        'I had work there before.',
                        'I had worked there before.',
                        'I have worked there before.',
                        'I was worked there before.'
                    ],
                    correct: 1,
                    hint: 'Past perfect uses "had" + past participle'
                },
                {
                    type: 'fill',
                    question: 'Complete: The movie _______ (start) when we got to the cinema.',
                    answer: 'had started',
                    hint: 'Use "had" + past participle of "start"'
                },
                {
                    type: 'fill',
                    question: 'Complete: They _______ (live) in Paris for five years before moving to Rome.',
                    answer: 'had lived',
                    hint: 'Use "had" + past participle of "live"'
                },
                {
                    type: 'multiple',
                    question: 'Choose the correct past perfect form:',
                    choices: [
                        'had walked',
                        'have walked',
                        'was walking',
                        'walked'
                    ],
                    correct: 0,
                    hint: 'Past perfect = had + past participle'
                },
                {
                    type: 'fill',
                    question: 'Complete: I _______ (never/see) such a beautiful sunset before that day.',
                    answer: 'had never seen',
                    hint: 'Use "had never" + past participle of "see"'
                },
                {
                    type: 'fill',
                    question: 'Complete: After she _______ (graduate), she found a good job.',
                    answer: 'had graduated',
                    hint: 'Use "had" + past participle of "graduate"'
                }
            ],
            2: [
                {
                    type: 'fill',
                    question: 'Complete: I _______ (go) to bed after I had finished my homework.',
                    answer: 'went',
                    hint: 'This is simple past, not past perfect!'
                },
                {
                    type: 'fill',
                    question: 'Complete: She realized she _______ (forget) her keys at home.',
                    answer: 'had forgotten',
                    hint: 'Past participle of "forget" is "forgotten"'
                },
                {
                    type: 'multiple',
                    question: 'What is the past participle of "break"?',
                    choices: ['breaked', 'broke', 'broken', 'breaking'],
                    correct: 2,
                    hint: 'Think about "break, broke, broken"'
                },
                {
                    type: 'fill',
                    question: 'Complete: The children _______ (eat) all the cookies before dinner.',
                    answer: 'had eaten',
                    hint: 'Past participle of "eat" is "eaten"'
                },
                {
                    type: 'fill',
                    question: 'Complete: He discovered that someone _______ (steal) his bicycle.',
                    answer: 'had stolen',
                    hint: 'Past participle of "steal" is "stolen"'
                },
                {
                    type: 'multiple',
                    question: 'Choose the correct sentence:',
                    choices: [
                        'I had chose the wrong answer.',
                        'I had chosen the wrong answer.',
                        'I had choose the wrong answer.',
                        'I have chose the wrong answer.'
                    ],
                    correct: 1,
                    hint: 'Past participle of "choose" is "chosen"'
                },
                {
                    type: 'fill',
                    question: 'Complete: They _______ (drive) for hours before they found a gas station.',
                    answer: 'had driven',
                    hint: 'Past participle of "drive" is "driven"'
                },
                {
                    type: 'fill',
                    question: 'Complete: She _______ (write) three letters before lunch.',
                    answer: 'had written',
                    hint: 'Past participle of "write" is "written"'
                }
            ],
            3: [
                {
                    type: 'multiple',
                    question: 'Which action happened first? "When I arrived at the party, most guests _______ home."',
                    choices: [
                        'went',
                        'had gone',
                        'were going',
                        'have gone'
                    ],
                    correct: 1,
                    hint: 'The guests left before I arrived - use past perfect'
                },
                {
                    type: 'fill',
                    question: 'Complete: After the rain _______ (stop), we went for a walk.',
                    answer: 'had stopped',
                    hint: 'The rain stopped first, then we walked'
                },
                {
                    type: 'multiple',
                    question: 'Choose the correct sequence: "She was tired because she _______ all night."',
                    choices: [
                        'worked',
                        'had worked',
                        'was working',
                        'works'
                    ],
                    correct: 1,
                    hint: 'Working all night caused her tiredness - use past perfect'
                },
                {
                    type: 'fill',
                    question: 'Complete: By the time the ambulance arrived, the injured man _______ (lose) a lot of blood.',
                    answer: 'had lost',
                    hint: 'He lost blood before the ambulance arrived'
                },
                {
                    type: 'fill',
                    question: 'Complete: I couldn\'t get into my house because I _______ (leave) my keys inside.',
                    answer: 'had left',
                    hint: 'Leaving keys inside happened before trying to get in'
                },
                {
                    type: 'multiple',
                    question: 'Which sentence shows the correct time sequence?',
                    choices: [
                        'After I had breakfast, I had brushed my teeth.',
                        'After I had had breakfast, I brushed my teeth.',
                        'After I have breakfast, I had brushed my teeth.',
                        'After I breakfast, I had brushed my teeth.'
                    ],
                    correct: 1,
                    hint: 'Breakfast happened first (past perfect), then brushing teeth (simple past)'
                },
                {
                    type: 'fill',
                    question: 'Complete: The concert _______ (begin) by the time we found our seats.',
                    answer: 'had begun',
                    hint: 'The concert started before we sat down'
                },
                {
                    type: 'fill',
                    question: 'Complete: She was angry because her brother _______ (break) her favorite vase.',
                    answer: 'had broken',
                    hint: 'Breaking the vase caused her anger - past perfect'
                }
            ],
            4: [
                {
                    type: 'fill',
                    question: 'Complete: If I _______ (know) about the traffic, I would have left earlier.',
                    answer: 'had known',
                    hint: 'This is a third conditional - use past perfect in the if clause'
                },
                {
                    type: 'multiple',
                    question: 'Which sentence is grammatically correct?',
                    choices: [
                        'I wish I had went to the party.',
                        'I wish I had gone to the party.',
                        'I wish I have gone to the party.',
                        'I wish I went to the party.'
                    ],
                    correct: 1,
                    hint: 'After "wish" about the past, use past perfect'
                },
                {
                    type: 'fill',
                    question: 'Complete: She acted as if she _______ (never/meet) him before.',
                    answer: 'had never met',
                    hint: 'After "as if" about the past, use past perfect'
                },
                {
                    type: 'fill',
                    question: 'Complete: No sooner _______ (we/arrive) than it started to rain.',
                    answer: 'had we arrived',
                    hint: 'After "no sooner", use inverted past perfect'
                },
                {
                    type: 'multiple',
                    question: 'Choose the correct third conditional:',
                    choices: [
                        'If she studied harder, she would have passed.',
                        'If she had studied harder, she would pass.',
                        'If she had studied harder, she would have passed.',
                        'If she has studied harder, she would have passed.'
                    ],
                    correct: 2,
                    hint: 'Third conditional: If + past perfect, would have + past participle'
                },
                {
                    type: 'fill',
                    question: 'Complete: Hardly _______ (the show/begin) when the lights went out.',
                    answer: 'had the show begun',
                    hint: 'After "hardly", use inverted past perfect'
                },
                {
                    type: 'fill',
                    question: 'Complete: By the end of the year, she _______ (save) enough money for a car.',
                    answer: 'had saved',
                    hint: 'Use past perfect for an action completed by a specific past time'
                },
                {
                    type: 'multiple',
                    question: 'Which sentence uses past perfect correctly in reported speech?',
                    choices: [
                        'He said he has finished his work.',
                        'He said he had finished his work.',
                        'He said he finished his work.',
                        'He said he finish his work.'
                    ],
                    correct: 1,
                    hint: 'In reported speech, present perfect becomes past perfect'
                }
            ]
        };

        const rewards = {
            points: [10, 15, 20, 25],
            badges: {
                5: { icon: 'üåü', name: 'Getting Started', description: '5 correct answers' },
                10: { icon: 'üéØ', name: 'Sharp Shooter', description: '10 correct answers' },
                20: { icon: 'üèÖ', name: 'Grammar Master', description: '20 correct answers' },
                50: { icon: 'üëë', name: 'Past Perfect King', description: '50 correct answers' },
                streak5: { icon: 'üî•', name: 'Hot Streak', description: '5 answers in a row' },
                streak10: { icon: '‚ö°', name: 'Lightning Round', description: '10 answers in a row' },
                level1: { icon: 'üå±', name: 'Beginner', description: 'Completed Level 1' },
                level2: { icon: '‚ö°', name: 'Irregular Expert', description: 'Completed Level 2' },
                level3: { icon: 'üé≠', name: 'Context Master', description: 'Completed Level 3' },
                level4: { icon: 'üèÜ', name: 'Grammar Champion', description: 'Completed Level 4' }
            }
        };

        function selectLevel(level) {
            currentLevel = level;
            
            // Update UI
            document.querySelectorAll('.level-card').forEach(card => card.classList.remove('active'));
            document.querySelectorAll('.level-card')[level - 1].classList.add('active');
            
            document.querySelectorAll('.exercise-area').forEach(area => area.classList.remove('active'));
            document.getElementById(`level${level}`).classList.add('active');
            
            generateExercises(level);
        }

        function generateExercises(level) {
            const container = document.getElementById(`exercises${level}`);
            container.innerHTML = '';
            
            exercises[level].forEach((exercise, index) => {
                const exerciseDiv = document.createElement('div');
                exerciseDiv.className = 'exercise-card';
                exerciseDiv.id = `exercise-${level}-${index}`;
                
                let content = `<div class="exercise-question">${index + 1}. ${exercise.question}</div>`;
                
                if (exercise.type === 'fill') {
                    content += `
                        <input type="text" class="exercise-input" id="input-${level}-${index}" placeholder="Type your answer here...">
                        <button class="btn" onclick="checkAnswer(${level}, ${index})">Check Answer</button>
                    `;
                } else if (exercise.type === 'multiple') {
                    content += '<div class="multiple-choice">';
                    exercise.choices.forEach((choice, choiceIndex) => {
                        content += `<div class="choice-btn" onclick="selectChoice(${level}, ${index}, ${choiceIndex})">${choice}</div>`;
                    });
                    content += '</div>';
                    content += `<button class="btn" onclick="checkMultipleChoice(${level}, ${index})" disabled id="check-${level}-${index}">Check Answer</button>`;
                }
                
                content += `
                    <div id="feedback-${level}-${index}"></div>
                    <div class="hint-box" style="display: none;" id="hint-${level}-${index}">
                        üí° ${exercise.hint}
                    </div>
                `;
                
                exerciseDiv.innerHTML = content;
                container.appendChild(exerciseDiv);
            });
        }

        let selectedChoices = {};

        function selectChoice(level, exerciseIndex, choiceIndex) {
            const exerciseId = `${level}-${exerciseIndex}`;
            selectedChoices[exerciseId] = choiceIndex;
            
            // Update UI
            const choices = document.querySelectorAll(`#exercise-${exerciseId} .choice-btn`);
            choices.forEach((choice, index) => {
                choice.classList.remove('selected');
                if (index === choiceIndex) {
                    choice.classList.add('selected');
                }
            });
            
            // Enable check button
            document.getElementById(`check-${level}-${exerciseIndex}`).disabled = false;
        }

        function checkAnswer(level, exerciseIndex) {
            const exercise = exercises[level][exerciseIndex];
            const userAnswer = document.getElementById(`input-${level}-${exerciseIndex}`).value.trim().toLowerCase();
            const correctAnswer = exercise.answer.toLowerCase();
            const inputElement = document.getElementById(`input-${level}-${exerciseIndex}`);
            const feedbackElement = document.getElementById(`feedback-${level}-${exerciseIndex}`);
            const hintElement = document.getElementById(`hint-${level}-${exerciseIndex}`);
            
            if (userAnswer === correctAnswer) {
                inputElement.classList.add('correct');
                feedbackElement.innerHTML = '<div class="feedback correct">‚úÖ Excellent! That\'s correct!</div>';
                document.getElementById(`exercise-${level}-${exerciseIndex}`).classList.add('completed');
                
                // Award points and update progress
                awardPoints(level);
                updateProgress(level);
                
                // Disable input and button
                inputElement.disabled = true;
                inputElement.nextElementSibling.disabled = true;
                
            } else {
                inputElement.classList.add('incorrect');
                inputElement.classList.add('shake');
                setTimeout(() => inputElement.classList.remove('shake'), 500);
                
                feedbackElement.innerHTML = `<div class="feedback incorrect">‚ùå Not quite right. The correct answer is: <strong>${exercise.answer}</strong></div>`;
                hintElement.style.display = 'block';
                
                // Reset streak
                currentStreak = 0;
                updateStats();
            }
        }

        function checkMultipleChoice(level, exerciseIndex) {
            const exerciseId = `${level}-${exerciseIndex}`;
            const exercise = exercises[level][exerciseIndex];
            const selectedChoice = selectedChoices[exerciseId];
            const feedbackElement = document.getElementById(`feedback-${exerciseId}`);
            const hintElement = document.getElementById(`hint-${exerciseId}`);
            const choices = document.querySelectorAll(`#exercise-${exerciseId} .choice-btn`);
            
            if (selectedChoice === exercise.correct) {
                choices[selectedChoice].classList.add('correct');
                feedbackElement.innerHTML = '<div class="feedback correct">‚úÖ Perfect! That\'s the right answer!</div>';
                document.getElementById(`exercise-${exerciseId}`).classList.add('completed');
                
                // Award points and update progress
                awardPoints(level);
                updateProgress(level);
                
                // Disable button
                document.getElementById(`check-${level}-${exerciseIndex}`).disabled = true;
                
            } else {
                choices[selectedChoice].classList.add('incorrect');
                choices[exercise.correct].classList.add('correct');
                
                feedbackElement.innerHTML = '<div class="feedback incorrect">‚ùå Not correct. The right answer is highlighted in green.</div>';
                hintElement.style.display = 'block';
                
                // Reset streak
                currentStreak = 0;
                updateStats();
            }
        }

        function awardPoints(level) {
            const points = rewards.points[level - 1];
            totalPoints += points;
            correctAnswers++;
            currentStreak++;
            
            updateStats();
            showReward(points, level);
            checkBadges();
        }

        function updateProgress(level) {
            levelProgress[level - 1]++;
            const progress = (levelProgress[level - 1] / exercises[level].length) * 100;
            
            document.getElementById(`progress${level}`).style.width = progress + '%';
            document.getElementById(`progress-text${level}`).textContent = 
                `${levelProgress[level - 1]}/${exercises[level].length} completed`;
            
            if (levelProgress[level - 1] === exercises[level].length) {
                levelCompleted[level - 1] = true;
                setTimeout(() => showLevelComplete(level), 1000);
            }
        }

        function updateStats() {
            document.getElementById('total-points').textContent = totalPoints;
            document.getElementById('correct-answers').textContent = correctAnswers;
            document.getElementById('current-streak').textContent = currentStreak;
            document.getElementById('badges-earned').textContent = badgesEarned;
        }

        function checkBadges() {
            const badges = rewards.badges;
            
            // Check score-based badges
            if (correctAnswers === 5 && !document.querySelector('[data-badge="5"]')) {
                earnBadge(badges[5], '5');
            }
            if (correctAnswers === 10 && !document.querySelector('[data-badge="10"]')) {
                earnBadge(badges[10], '10');
            }
            if (correctAnswers === 20 && !document.querySelector('[data-badge="20"]')) {
                earnBadge(badges[20], '20');
            }
            if (correctAnswers === 50 && !document.querySelector('[data-badge="50"]')) {
                earnBadge(badges[50], '50');
            }
            
            // Check streak badges
            if (currentStreak === 5 && !document.querySelector('[data-badge="streak5"]')) {
                earnBadge(badges.streak5, 'streak5');
            }
            if (currentStreak === 10 && !document.querySelector('[data-badge="streak10"]')) {
                earnBadge(badges.streak10, 'streak10');
            }
            
            // Check level completion badges
            levelCompleted.forEach((completed, index) => {
                const level = index + 1;
                const badgeKey = `level${level}`;
                if (completed && !document.querySelector(`[data-badge="${badgeKey}"]`)) {
                    earnBadge(badges[badgeKey], badgeKey);
                }
            });
        }

        function earnBadge(badge, key) {
            badgesEarned++;
            const badgeElement = document.createElement('div');
            badgeElement.className = 'achievement-badge';
            badgeElement.setAttribute('data-badge', key);
            badgeElement.innerHTML = `${badge.icon} ${badge.name}`;
            badgeElement.title = badge.description;
            
            // Add to stats area (you could create a badges display area)
            updateStats();
        }

        function showReward(points, level) {
            const rewardIcon = document.getElementById('reward-icon');
            const rewardTitle = document.getElementById('reward-title');
            const rewardMessage = document.getElementById('reward-message');
            const rewardBadges = document.getElementById('reward-badges');
            
            // Different rewards based on performance
            const icons = ['üéâ', 'üåü', '‚ú®', 'üèÜ', 'üéØ', '‚ö°', 'üî•'];
            const messages = [
                'Great job!', 'Excellent!', 'Outstanding!', 'Fantastic!', 
                'Brilliant!', 'Superb!', 'Amazing!'
            ];
            
            rewardIcon.textContent = icons[Math.floor(Math.random() * icons.length)];
            rewardTitle.textContent = messages[Math.floor(Math.random() * messages.length)];
            rewardMessage.textContent = `You earned ${points} points!`;
            
            if (currentStreak >= 5) {
                rewardMessage.textContent += ` üî• ${currentStreak} in a row!`;
            }
            
            // Show recent badges
            rewardBadges.innerHTML = '';
            const recentBadges = document.querySelectorAll('.achievement-badge');
            if (recentBadges.length > 0) {
                const lastBadge = recentBadges[recentBadges.length - 1];
                if (lastBadge) {
                    rewardBadges.innerHTML = `<p>New Badge: ${lastBadge.innerHTML}</p>`;
                }
            }
            
            // Show popup
            document.getElementById('overlay').classList.add('show');
            document.getElementById('reward-popup').classList.add('show');
        }

        function showLevelComplete(level) {
            const rewardIcon = document.getElementById('reward-icon');
            const rewardTitle = document.getElementById('reward-title');
            const rewardMessage = document.getElementById('reward-message');
            const rewardBadges = document.getElementById('reward-badges');
            
            rewardIcon.textContent = 'üèÜ';
            rewardTitle.textContent = `Level ${level} Complete!`;
            rewardMessage.textContent = 'Congratulations! You\'ve mastered this level!';
            
            const bonus = level * 50;
            totalPoints += bonus;
            updateStats();
            rewardMessage.textContent += ` Bonus: ${bonus} points!`;
            
            rewardBadges.innerHTML = `<p>üéñÔ∏è Level ${level} Badge Earned!</p>`;
            
            // Show popup
            document.getElementById('overlay').classList.add('show');
            document.getElementById('reward-popup').classList.add('show');
        }

        function closeReward() {
            document.getElementById('overlay').classList.remove('show');
            document.getElementById('reward-popup').classList.remove('show');
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            selectLevel(1); // Start with level 1
        });

        // Close popup when clicking overlay
        document.getElementById('overlay').addEventListener('click', closeReward);
    </script>
</body>
</html>
